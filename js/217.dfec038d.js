"use strict";(self["webpackChunkeribbit_client_pc"]=self["webpackChunkeribbit_client_pc"]||[]).push([[217],{1769:function(e,a,o){o.r(a),o.d(a,{default:function(){return ge}});var l=o(3396),c=o(7139);const s=e=>((0,l.dD)("data-v-51e47612"),e=e(),(0,l.Cn)(),e),n={key:0,class:"container"},t=s((()=>(0,l._)("div",{class:"unbind"},[(0,l._)("div",{class:"loading"})],-1))),i=[t],r={key:1,class:"container"},d={class:"tab"},u=s((()=>(0,l._)("i",{class:"iconfont icon-bind"},null,-1))),m=s((()=>(0,l._)("span",null,"已有小兔鲜账号，请绑定手机",-1))),p=[u,m],v=s((()=>(0,l._)("i",{class:"iconfont icon-edit"},null,-1))),f=s((()=>(0,l._)("span",null,"没有小兔鲜账号，请完善资料",-1))),_=[v,f],b={key:0,class:"tab-content"},k={key:1,class:"tab-content"};function w(e,a,o,s,t,u){const m=(0,l.up)("LoginHeader"),v=(0,l.up)("CallbackBind"),f=(0,l.up)("CallbackPatch"),w=(0,l.up)("LoginFooter");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Uk)("联合登录")])),_:1}),s.isBind?((0,l.wg)(),(0,l.iD)("section",n,i)):((0,l.wg)(),(0,l.iD)("section",r,[(0,l._)("nav",d,[(0,l._)("a",{onClick:a[0]||(a[0]=e=>s.hasAccount=!0),class:(0,c.C_)({active:s.hasAccount}),href:"javascript:;"},p,2),(0,l._)("a",{onClick:a[1]||(a[1]=e=>s.hasAccount=!1),class:(0,c.C_)({active:!s.hasAccount}),href:"javascript:;"},_,2)]),s.hasAccount?((0,l.wg)(),(0,l.iD)("div",b,[(0,l.Wm)(v,{unionId:s.unionId,nickname:e.nickname,avatar:e.avatar},null,8,["unionId","nickname","avatar"])])):((0,l.wg)(),(0,l.iD)("div",k,[(0,l.Wm)(f,{unionId:s.unionId},null,8,["unionId"])]))])),(0,l.Wm)(w)],64)}o(7658);var h=o(2900);const g=e=>((0,l.dD)("data-v-ce7e7c28"),e=e(),(0,l.Cn)(),e),y={class:"xtx-form-item"},C={class:"field"},x=g((()=>(0,l._)("i",{class:"icon iconfont icon-user"},null,-1))),Z={key:0,class:"error"},V={class:"xtx-form-item"},I={class:"field"},D=g((()=>(0,l._)("i",{class:"icon iconfont icon-phone"},null,-1))),H={key:0,class:"error"},F={class:"xtx-form-item"},P={class:"field"},U=g((()=>(0,l._)("i",{class:"icon iconfont icon-code"},null,-1))),W={key:0,class:"error"},q={class:"xtx-form-item"},z={class:"field"},j=g((()=>(0,l._)("i",{class:"icon iconfont icon-lock"},null,-1))),A={key:0,class:"error"},L={class:"xtx-form-item"},N={class:"field"},S=g((()=>(0,l._)("i",{class:"icon iconfont icon-lock"},null,-1))),B={key:0,class:"error"};function Q(e,a,o,s,n,t){const i=(0,l.up)("Field"),r=(0,l.up)("Form");return(0,l.wg)(),(0,l.j4)(r,{ref:"formCom","validation-schema":s.mySchema,class:"xtx-form",autocomplete:"off"},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",y,[(0,l._)("div",C,[x,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.account},"input"]),modelValue:s.form.account,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.account=e),name:"account",type:"text",placeholder:"请输入用户名"},null,8,["class","modelValue"])]),e.account?((0,l.wg)(),(0,l.iD)("div",Z,(0,c.zw)(e.account),1)):(0,l.kq)("",!0)]),(0,l._)("div",V,[(0,l._)("div",I,[D,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.mobile},"input"]),modelValue:s.form.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.mobile=e),name:"mobile",type:"text",placeholder:"请输入手机号"},null,8,["class","modelValue"])]),e.mobile?((0,l.wg)(),(0,l.iD)("div",H,(0,c.zw)(e.mobile),1)):(0,l.kq)("",!0)]),(0,l._)("div",F,[(0,l._)("div",P,[U,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.code},"input"]),modelValue:s.form.code,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form.code=e),name:"code",type:"text",placeholder:"请输入验证码"},null,8,["class","modelValue"]),(0,l._)("span",{onClick:a[3]||(a[3]=e=>s.send()),class:"code"},(0,c.zw)(0===s.time?"发送验证码":`${s.time}秒后发送`),1)]),e.code?((0,l.wg)(),(0,l.iD)("div",W,(0,c.zw)(e.code),1)):(0,l.kq)("",!0)]),(0,l._)("div",q,[(0,l._)("div",z,[j,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.password},"input"]),modelValue:s.form.password,"onUpdate:modelValue":a[4]||(a[4]=e=>s.form.password=e),name:"password",type:"password",placeholder:"请输入密码"},null,8,["class","modelValue"])]),e.password?((0,l.wg)(),(0,l.iD)("div",A,(0,c.zw)(e.password),1)):(0,l.kq)("",!0)]),(0,l._)("div",L,[(0,l._)("div",N,[S,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.rePassword},"input"]),modelValue:s.form.rePassword,"onUpdate:modelValue":a[5]||(a[5]=e=>s.form.rePassword=e),name:"rePassword",type:"password",placeholder:"请确认密码"},null,8,["class","modelValue"])]),e.rePassword?((0,l.wg)(),(0,l.iD)("div",B,(0,c.zw)(e.rePassword),1)):(0,l.kq)("",!0)]),(0,l._)("a",{href:"javascript:;",onClick:a[6]||(a[6]=e=>s.submit()),class:"submit"},"立即提交")])),_:1},8,["validation-schema"])}var R=o(4419),E=o(5708),$=o(4870),K=o(2025),M=o(8391),O=o(65),Y=o(2483),G={name:"CallbackPatch",components:{Form:E.l0,Field:E.gN},props:{unionId:{type:String,default:""}},setup(e){const a=(0,$.qj)({mobile:null,account:null,code:null,password:null,rePassword:null}),o={mobile:K.Z.mobile,account:K.Z.accountApi,code:K.Z.code,password:K.Z.password,rePassword:K.Z.rePassword},l=(0,$.iH)(null),c=(0,$.iH)(0),{pause:s,resume:n}=(0,R.Zv)((()=>{c.value--,c.value<=0&&s()}),1e3,{immediate:!1}),t=async()=>{const e=o.mobile(a.mobile);!0===e?0===c.value&&(await(0,h.bp)(a.mobile),(0,M.Z)({type:"success",text:"短信验证码发送成功"}),c.value=60,n()):l.value.setFieldError("mobile",e)},i=(0,O.oR)(),r=(0,Y.tv)(),d=async()=>{const o=l.value.validate();o&&(0,h.lj)({unionId:e.unionId,mobile:a.mobile,code:a.code,password:a.password,account:a.account}).then((e=>{console.log("绑定成功！",e);const{id:a,account:o,avatar:l,mobile:c,nickName:s,token:n}=e.result;i.commit("user/setUser",{id:a,account:o,avatar:l,mobile:c,nickName:s,token:n}),i.dispatch("cart/mergeCart").then((()=>{r.push(i.state.user.redirecturl||"/"),(0,M.Z)({type:"success",text:"登录成功"})}))})).catch((e=>{(0,M.Z)({type:"error",text:"绑定失败"})}))};return{form:a,mySchema:o,send:t,formCom:l,time:c,submit:d}}},J=o(89);const T=(0,J.Z)(G,[["render",Q],["__scopeId","data-v-ce7e7c28"]]);var X=T;const ee=e=>((0,l.dD)("data-v-052aa9ea"),e=e(),(0,l.Cn)(),e),ae={class:"user-info"},oe=["src"],le={class:"xtx-form-item"},ce={class:"field"},se=ee((()=>(0,l._)("i",{class:"icon iconfont icon-phone"},null,-1))),ne={key:0,class:"error"},te={class:"xtx-form-item"},ie={class:"field"},re=ee((()=>(0,l._)("i",{class:"icon iconfont icon-code"},null,-1))),de={key:0,class:"error"};function ue(e,a,o,s,n,t){const i=(0,l.up)("Field"),r=(0,l.up)("Form");return(0,l.wg)(),(0,l.j4)(r,{ref:"formCom","validation-schema":s.mySchema,class:"xtx-form",autocomplete:"off"},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",ae,[(0,l._)("img",{src:s.avatar,alt:""},null,8,oe),(0,l._)("p",null,"Hi，"+(0,c.zw)(s.nickname)+" 欢迎来小兔鲜，完成绑定后可以QQ账号一键登录哦~",1)]),(0,l._)("div",le,[(0,l._)("div",ce,[se,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.mobile},"input"]),modelValue:s.form.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.mobile=e),name:"mobile",type:"text",placeholder:"绑定的手机号"},null,8,["class","modelValue"])]),e.mobile?((0,l.wg)(),(0,l.iD)("div",ne,(0,c.zw)(e.mobile),1)):(0,l.kq)("",!0)]),(0,l._)("div",te,[(0,l._)("div",ie,[re,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.code},"input"]),modelValue:s.form.code,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.code=e),name:"code",type:"text",placeholder:"短信验证码"},null,8,["class","modelValue"]),(0,l._)("span",{class:"code",onClick:a[2]||(a[2]=e=>s.send())},(0,c.zw)(0===s.time?"发送验证码":`${s.time}秒后发送`),1)]),e.code?((0,l.wg)(),(0,l.iD)("div",de,(0,c.zw)(e.code),1)):(0,l.kq)("",!0)]),(0,l._)("a",{onClick:a[3]||(a[3]=e=>s.submit()),href:"javascript:;",class:"submit"},"立即绑定")])),_:1},8,["validation-schema"])}var me=o(9716),pe=o.n(me),ve={name:"CallbackBind",props:{unionId:{type:String,default:""}},components:{Form:E.l0,Field:E.gN},setup(e){const a=(0,$.iH)(null),o=(0,$.iH)(null),l=(0,Y.tv)(),c=(0,O.oR)();pe().Login.check()&&pe().api("get_user_info").success((e=>{console.log(e),a.value=e.data.nickname,o.value=e.data.figureurl_1}));const s=(0,$.qj)({mobile:null,code:null}),n={mobile:K.Z.mobile,code:K.Z.code},t=(0,$.iH)(0),{pause:i,resume:r}=(0,R.Zv)((()=>{t.value--,t.value<=0&&i()}),1e3,{immediate:!1}),d=(0,$.iH)(null),u=async()=>{const e=n.mobile(s.mobile);!0===e?0===t.value&&(await(0,h.Oq)(s.mobile),(0,M.Z)({type:"success",text:"短信验证码发送成功"}),t.value=60,r()):d.value.setFieldError("mobile",e)},m=async()=>{const a=d.value.validate();a&&(0,h.UA)({unionId:e.unionId,mobile:s.mobile,code:s.code}).then((e=>{const{id:a,account:o,avatar:s,mobile:n,nickName:t,token:i}=e.result;c.commit("user/setUser",{id:a,account:o,avatar:s,mobile:n,nickName:t,token:i}),c.dispatch("cart/mergeCart").then((()=>{l.push(c.state.user.redirecturl||"/"),(0,M.Z)({type:"success",text:"登录成功"})}))})).catch((e=>{(0,M.Z)({type:"error",text:"绑定失败"})}))};return{nickname:a,avatar:o,form:s,mySchema:n,send:u,formCom:d,time:t,submit:m}}};const fe=(0,J.Z)(ve,[["render",ue],["__scopeId","data-v-052aa9ea"]]);var _e=fe,be=o(7442),ke=o(8388),we={name:"LoginCallback",components:{LoginHeader:be.Z,LoginFooter:ke.Z,CallbackBind:_e,CallbackPatch:X},setup(){const e=(0,$.iH)(!1),a=(0,O.oR)(),o=(0,Y.tv)(),l=(0,$.iH)(null),c=(0,$.iH)(!0);return pe().Login.check()&&pe().Login.getMe((e=>{l.value=e,(0,h.K9)(e).then((e=>{console.log("登录成功",e);const{id:l,account:c,avatar:s,mobile:n,nickName:t,token:i}=e.result;a.commit("user/setUser",{id:l,account:c,avatar:s,mobile:n,nickName:t,token:i}),a.dispatch("cart/mergeCart").then((()=>{o.push(a.state.user.redirecturl||"/"),(0,M.Z)({type:"success",text:"登录成功"})}))})).catch((e=>{c.value=!1,(0,M.Z)({type:"error",text:"QQ未绑定账号"})}))})),{hasAccount:e,isBind:c,unionId:l}}};const he=(0,J.Z)(we,[["render",w],["__scopeId","data-v-51e47612"]]);var ge=he}}]);
//# sourceMappingURL=217.dfec038d.js.map