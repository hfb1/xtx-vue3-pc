{"version":3,"file":"js/217.dfec038d.js","mappings":"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","sources":["webpack://eribbit-client-pc/./src/views/login/components/callback.vue","webpack://eribbit-client-pc/./src/views/login/components/callback-patch.vue","webpack://eribbit-client-pc/./src/views/login/components/callback-patch.vue?4bcc","webpack://eribbit-client-pc/./src/views/login/components/callback-bind.vue","webpack://eribbit-client-pc/./src/views/login/components/callback-bind.vue?e73a","webpack://eribbit-client-pc/./src/views/login/components/callback.vue?7941"],"sourcesContent":["<template>\r\n  <LoginHeader>联合登录</LoginHeader>\r\n  <section class=\"container\" v-if=\"isBind\">\r\n    <div class=\"unbind\">\r\n      <div class=\"loading\"></div>\r\n    </div>\r\n  </section>\r\n  <section class=\"container\" v-else>\r\n    <nav class=\"tab\">\r\n      <a\r\n        @click=\"hasAccount = true\"\r\n        :class=\"{ active: hasAccount }\"\r\n        href=\"javascript:;\"\r\n      >\r\n        <i class=\"iconfont icon-bind\" />\r\n        <span>已有小兔鲜账号，请绑定手机</span>\r\n      </a>\r\n      <a\r\n        @click=\"hasAccount = false\"\r\n        :class=\"{ active: !hasAccount }\"\r\n        href=\"javascript:;\"\r\n      >\r\n        <i class=\"iconfont icon-edit\" />\r\n        <span>没有小兔鲜账号，请完善资料</span>\r\n      </a>\r\n    </nav>\r\n    <div class=\"tab-content\" v-if=\"hasAccount\">\r\n      <CallbackBind :unionId=\"unionId\" :nickname=\"nickname\" :avatar=\"avatar\" />\r\n    </div>\r\n    <div class=\"tab-content\" v-else>\r\n      <CallbackPatch :unionId=\"unionId\" />\r\n    </div>\r\n  </section>\r\n  <LoginFooter />\r\n</template>\r\n\r\n<script>\r\nimport { userQQLogin } from '@/api/user'\r\nimport CallbackPatch from './callback-patch.vue'\r\nimport CallbackBind from './callback-bind.vue'\r\nimport LoginHeader from './login-header.vue'\r\nimport LoginFooter from './login-footer.vue'\r\nimport QC from 'qc'\r\nimport { ref } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { useRouter } from 'vue-router'\r\nimport Message from '@/components/library/Message'\r\nexport default {\r\n  name: 'LoginCallback',\r\n  components: { LoginHeader, LoginFooter, CallbackBind, CallbackPatch },\r\n  setup () {\r\n    const hasAccount = ref(false)\r\n    const store = useStore()\r\n    const router = useRouter()\r\n    const unionId = ref(null)\r\n    // 首先，默认认为已经注册而且已经绑定\r\n    // 通过qq的api获取openId就是后台需要的unionId然后进行登录\r\n    // 如果成功：登录成功\r\n    // 如果失败：该qq未和小兔鲜进行绑定（有账号未绑定qq，没有账号未绑定qq）\r\n\r\n    // 是否绑定\r\n    const isBind = ref(true)\r\n    // QC.Login.check()判断qq是否登录\r\n    if (QC.Login.check()) {\r\n      // qq已经登录\r\n      QC.Login.getMe((openId) => {\r\n        unionId.value = openId\r\n        // 第三方的唯一标识\r\n        // 请求小兔鲜后台，做qq登录\r\n        userQQLogin(openId).then(data => {\r\n          // data.result就是用户信息\r\n          console.log('登录成功', data)\r\n          // 1.存储用户信息\r\n          // 2.跳转到来源页或者首页\r\n          // 3.成功提示\r\n          const { id, account, avatar, mobile, nickName, token } = data.result\r\n          store.commit('user/setUser', { id, account, avatar, mobile, nickName, token })\r\n          store.dispatch('cart/mergeCart').then(() => {\r\n            // 进行路由跳转\r\n            router.push(store.state.user.redirecturl || '/')\r\n            // 信息提示\r\n            Message({ type: 'success', text: '登录成功' })\r\n          })\r\n        }).catch(e => {\r\n          isBind.value = false\r\n          Message({ type: 'error', text: 'QQ未绑定账号' })\r\n        })\r\n      })\r\n    }\r\n    return {\r\n      hasAccount,\r\n      isBind,\r\n      unionId\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.container {\r\n  padding: 25px 0;\r\n  position: relative;\r\n  height: 730px;\r\n  .unbind {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 25px 0;\r\n    z-index: 99;\r\n    .loading {\r\n      height: 100%;\r\n      background: #fff url(../../../assets/images/load.gif) no-repeat center /\r\n        100px 100px;\r\n    }\r\n  }\r\n}\r\n.tab {\r\n  background: #fff;\r\n  height: 80px;\r\n  padding-top: 40px;\r\n  font-size: 18px;\r\n  text-align: center;\r\n  a {\r\n    color: #666;\r\n    display: inline-block;\r\n    width: 350px;\r\n    line-height: 40px;\r\n    border-bottom: 2px solid #e4e4e4;\r\n    i {\r\n      font-size: 22px;\r\n      vertical-align: middle;\r\n    }\r\n    span {\r\n      vertical-align: middle;\r\n      margin-left: 4px;\r\n    }\r\n    &.active {\r\n      color: @xtxColor;\r\n      border-color: @xtxColor;\r\n    }\r\n  }\r\n}\r\n.tab-content {\r\n  min-height: 600px;\r\n  background: #fff;\r\n}\r\n</style>\r\n","<template>\r\n  <Form\r\n    ref=\"formCom\"\r\n    :validation-schema=\"mySchema\"\r\n    v-slot=\"{ errors }\"\r\n    class=\"xtx-form\"\r\n    autocomplete=\"off\"\r\n  >\r\n    <div class=\"xtx-form-item\">\r\n      <div class=\"field\">\r\n        <i class=\"icon iconfont icon-user\"></i>\r\n        <Field\r\n          :class=\"{ err: errors.account }\"\r\n          v-model=\"form.account\"\r\n          name=\"account\"\r\n          class=\"input\"\r\n          type=\"text\"\r\n          placeholder=\"请输入用户名\"\r\n        />\r\n      </div>\r\n      <div v-if=\"errors.account\" class=\"error\">{{ errors.account }}</div>\r\n    </div>\r\n    <div class=\"xtx-form-item\">\r\n      <div class=\"field\">\r\n        <i class=\"icon iconfont icon-phone\"></i>\r\n        <Field\r\n          :class=\"{ err: errors.mobile }\"\r\n          v-model=\"form.mobile\"\r\n          name=\"mobile\"\r\n          class=\"input\"\r\n          type=\"text\"\r\n          placeholder=\"请输入手机号\"\r\n        />\r\n      </div>\r\n      <div v-if=\"errors.mobile\" class=\"error\">\r\n        {{ errors.mobile }}\r\n      </div>\r\n    </div>\r\n    <div class=\"xtx-form-item\">\r\n      <div class=\"field\">\r\n        <i class=\"icon iconfont icon-code\"></i>\r\n        <Field\r\n          :class=\"{ err: errors.code }\"\r\n          v-model=\"form.code\"\r\n          name=\"code\"\r\n          class=\"input\"\r\n          type=\"text\"\r\n          placeholder=\"请输入验证码\"\r\n        />\r\n        <span @click=\"send()\" class=\"code\">{{\r\n          time === 0 ? \"发送验证码\" : `${time}秒后发送`\r\n        }}</span>\r\n      </div>\r\n      <div v-if=\"errors.code\" class=\"error\">{{ errors.code }}</div>\r\n    </div>\r\n    <div class=\"xtx-form-item\">\r\n      <div class=\"field\">\r\n        <i class=\"icon iconfont icon-lock\"></i>\r\n        <Field\r\n          :class=\"{ err: errors.password }\"\r\n          v-model=\"form.password\"\r\n          name=\"password\"\r\n          class=\"input\"\r\n          type=\"password\"\r\n          placeholder=\"请输入密码\"\r\n        />\r\n      </div>\r\n      <div v-if=\"errors.password\" class=\"error\">{{ errors.password }}</div>\r\n    </div>\r\n    <div class=\"xtx-form-item\">\r\n      <div class=\"field\">\r\n        <i class=\"icon iconfont icon-lock\"></i>\r\n        <Field\r\n          :class=\"{ err: errors.rePassword }\"\r\n          v-model=\"form.rePassword\"\r\n          name=\"rePassword\"\r\n          class=\"input\"\r\n          type=\"password\"\r\n          placeholder=\"请确认密码\"\r\n        />\r\n      </div>\r\n      <div v-if=\"errors.rePassword\" class=\"error\">{{ errors.rePassword }}</div>\r\n    </div>\r\n    <a href=\"javascript:;\" @click=\"submit()\" class=\"submit\">立即提交</a>\r\n  </Form>\r\n</template>\r\n\r\n<script>\r\nimport { useIntervalFn } from '@vueuse/core'\r\nimport { Form, Field } from 'vee-validate'\r\nimport { reactive, ref } from 'vue'\r\nimport schema from '@/utils/vee-validate-schema'\r\nimport Message from '@/components/library/Message'\r\nimport { userQQPatchCode, userQQPatchLogin } from '@/api/user'\r\nimport { useStore } from 'vuex'\r\nimport { useRouter } from 'vue-router'\r\nexport default {\r\n  name: 'CallbackPatch',\r\n  components: { Form, Field },\r\n  props: {\r\n    unionId: {\r\n      type: String,\r\n      default: ''\r\n    }\r\n  },\r\n  setup (props) {\r\n    // 1. 表单校验 多两个校验规则：用户是否存在，再次输入密码是否一致\r\n    // 2.发送短信验证码：发送的接口api定义\r\n    // 3.完善信息\r\n\r\n    // 表单数据对象\r\n    const form = reactive({\r\n      mobile: null,\r\n      account: null,\r\n      code: null,\r\n      password: null,\r\n      rePassword: null\r\n    })\r\n    // 校验规则\r\n    const mySchema = {\r\n      mobile: schema.mobile,\r\n      account: schema.accountApi,\r\n      code: schema.code,\r\n      password: schema.password,\r\n      rePassword: schema.rePassword\r\n    }\r\n    // 表单组件\r\n    const formCom = ref(null)\r\n    // 定时器 返回值：pause暂停  resume开启\r\n    // useIntervalFn(回调函数，执行间隔，是否立即开启)\r\n    const time = ref(0)\r\n    const { pause, resume } = useIntervalFn(() => {\r\n      time.value--\r\n      if (time.value <= 0) {\r\n        pause()\r\n      }\r\n    }, 1000, { immediate: false })\r\n    // 发送验证码\r\n    const send = async () => {\r\n      const valid = mySchema.mobile(form.mobile)\r\n      if (valid === true) {\r\n        // 通过\r\n        // 没有倒计时才可以发送\r\n        if (time.value === 0) {\r\n          await userQQPatchCode(form.mobile)\r\n          Message({ type: 'success', text: '短信验证码发送成功' })\r\n          time.value = 60\r\n          resume()\r\n        }\r\n      } else {\r\n        // 没通过，使用 vee错误函数 显示错误信息\r\n        // 使用setFieldError(字段名称，错误信息)\r\n        formCom.value.setFieldError('mobile', valid)\r\n      }\r\n    }\r\n    // 立即提交\r\n    const store = useStore()\r\n    const router = useRouter()\r\n    const submit = async () => {\r\n      const valid = formCom.value.validate()\r\n      if (valid) {\r\n        userQQPatchLogin({\r\n          unionId: props.unionId,\r\n          mobile: form.mobile,\r\n          code: form.code,\r\n          password: form.password,\r\n          account: form.account\r\n        }).then(data => {\r\n          console.log('绑定成功！', data)\r\n          const { id, account, avatar, mobile, nickName, token } = data.result\r\n          store.commit('user/setUser', { id, account, avatar, mobile, nickName, token })\r\n          store.dispatch('cart/mergeCart').then(() => {\r\n            // 进行路由跳转\r\n            router.push(store.state.user.redirecturl || '/')\r\n            // 信息提示\r\n            Message({ type: 'success', text: '登录成功' })\r\n          })\r\n        }).catch(e => {\r\n          Message({ type: 'error', text: '绑定失败' })\r\n        })\r\n      }\r\n    }\r\n    return {\r\n      form,\r\n      mySchema,\r\n      send,\r\n      formCom,\r\n      time,\r\n      submit\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang='less'>\r\n.code {\r\n  position: absolute;\r\n  right: 0;\r\n  top: 0;\r\n  line-height: 50px;\r\n  width: 80px;\r\n  color: #999;\r\n  &:hover {\r\n    cursor: pointer;\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./callback-patch.vue?vue&type=template&id=ce7e7c28&scoped=true\"\nimport script from \"./callback-patch.vue?vue&type=script&lang=js\"\nexport * from \"./callback-patch.vue?vue&type=script&lang=js\"\n\nimport \"./callback-patch.vue?vue&type=style&index=0&id=ce7e7c28&scoped=true&lang=less\"\n\nimport exportComponent from \"C:\\\\Users\\\\Administrator\\\\Desktop\\\\eribbit-client-pc\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-ce7e7c28\"]])\n\nexport default __exports__","<template>\r\n  <Form\r\n    ref=\"formCom\"\r\n    :validation-schema=\"mySchema\"\r\n    v-slot=\"{ errors }\"\r\n    class=\"xtx-form\"\r\n    autocomplete=\"off\"\r\n  >\r\n    <div class=\"user-info\">\r\n      <img :src=\"avatar\" alt=\"\" />\r\n      <p>Hi，{{ nickname }} 欢迎来小兔鲜，完成绑定后可以QQ账号一键登录哦~</p>\r\n    </div>\r\n    <div class=\"xtx-form-item\">\r\n      <div class=\"field\">\r\n        <i class=\"icon iconfont icon-phone\"></i>\r\n        <Field\r\n          :class=\"{ err: errors.mobile }\"\r\n          v-model=\"form.mobile\"\r\n          name=\"mobile\"\r\n          class=\"input\"\r\n          type=\"text\"\r\n          placeholder=\"绑定的手机号\"\r\n        />\r\n      </div>\r\n      <div v-if=\"errors.mobile\" class=\"error\">{{ errors.mobile }}</div>\r\n    </div>\r\n    <div class=\"xtx-form-item\">\r\n      <div class=\"field\">\r\n        <i class=\"icon iconfont icon-code\"></i>\r\n        <Field\r\n          :class=\"{ err: errors.code }\"\r\n          v-model=\"form.code\"\r\n          name=\"code\"\r\n          class=\"input\"\r\n          type=\"text\"\r\n          placeholder=\"短信验证码\"\r\n        />\r\n        <span class=\"code\" @click=\"send()\">{{\r\n          time === 0 ? \"发送验证码\" : `${time}秒后发送`\r\n        }}</span>\r\n      </div>\r\n      <div v-if=\"errors.code\" class=\"error\">{{ errors.code }}</div>\r\n    </div>\r\n    <a @click=\"submit()\" href=\"javascript:;\" class=\"submit\">立即绑定</a>\r\n  </Form>\r\n</template>\r\n\r\n<script>\r\nimport { useIntervalFn } from '@vueuse/core'\r\nimport { reactive, ref } from 'vue'\r\nimport { Form, Field } from 'vee-validate'\r\nimport schema from '@/utils/vee-validate-schema'\r\nimport QC from 'qc'\r\nimport { userQQBindCode, userQQBindLogin } from '@/api/user'\r\nimport Message from '@/components/library/Message'\r\nimport { useRouter } from 'vue-router'\r\nimport { useStore } from 'vuex'\r\nexport default {\r\n  name: 'CallbackBind',\r\n  props: {\r\n    unionId: {\r\n      type: String,\r\n      default: ''\r\n    }\r\n  },\r\n  components: { Form, Field },\r\n  setup (props) {\r\n    // 1.准备下信息：openId,qq头像，昵称\r\n    // 2.完成表单的效验\r\n    // 3.发送验证码（校验，定义api，调用，完成倒计时）\r\n    // 4.进行绑定（绑定成功就是登录成功）\r\n    const nickname = ref(null)\r\n    const avatar = ref(null)\r\n    const router = useRouter()\r\n    const store = useStore()\r\n    if (QC.Login.check()) {\r\n      QC.api('get_user_info').success(res => {\r\n        console.log(res)\r\n        nickname.value = res.data.nickname\r\n        avatar.value = res.data.figureurl_1\r\n      })\r\n    }\r\n    // 表单数据对象\r\n    const form = reactive({\r\n      mobile: null,\r\n      code: null\r\n    })\r\n    // 效验规则对象\r\n    const mySchema = {\r\n      mobile: schema.mobile,\r\n      code: schema.code\r\n    }\r\n\r\n    // 定时器 返回值：pause暂停  resume开启\r\n    // useIntervalFn(回调函数，执行间隔，是否立即开启)\r\n    const time = ref(0)\r\n    const { pause, resume } = useIntervalFn(() => {\r\n      time.value--\r\n      if (time.value <= 0) {\r\n        pause()\r\n      }\r\n    }, 1000, { immediate: false })\r\n\r\n    // Form组件\r\n    const formCom = ref(null)\r\n    // 发送短信验证码\r\n    // 发送短信方法\r\n    const send = async () => {\r\n      const valid = mySchema.mobile(form.mobile)\r\n      if (valid === true) {\r\n        // 通过\r\n        // 没有倒计时才可以发送\r\n        if (time.value === 0) {\r\n          await userQQBindCode(form.mobile)\r\n          Message({ type: 'success', text: '短信验证码发送成功' })\r\n          time.value = 60\r\n          resume()\r\n        }\r\n      } else {\r\n        // 没通过，使用 vee错误函数 显示错误信息\r\n        // 使用setFieldError(字段名称，错误信息)\r\n        formCom.value.setFieldError('mobile', valid)\r\n      }\r\n    }\r\n    // 绑定手机号\r\n    const submit = async () => {\r\n      const valid = formCom.value.validate()\r\n      if (valid) {\r\n        userQQBindLogin({\r\n          unionId: props.unionId,\r\n          mobile: form.mobile,\r\n          code: form.code\r\n        }).then(data => {\r\n          const { id, account, avatar, mobile, nickName, token } = data.result\r\n          store.commit('user/setUser', { id, account, avatar, mobile, nickName, token })\r\n          store.dispatch('cart/mergeCart').then(() => {\r\n            // 进行路由跳转\r\n            router.push(store.state.user.redirecturl || '/')\r\n            // 信息提示\r\n            Message({ type: 'success', text: '登录成功' })\r\n          })\r\n        }).catch(e => {\r\n          Message({ type: 'error', text: '绑定失败' })\r\n        })\r\n      }\r\n    }\r\n    return {\r\n      nickname,\r\n      avatar,\r\n      form,\r\n      mySchema,\r\n      send,\r\n      formCom,\r\n      time,\r\n      submit\r\n    }\r\n  }\r\n\r\n}\r\n</script>\r\n\r\n<style scoped lang='less'>\r\n.user-info {\r\n  width: 320px;\r\n  height: 70px;\r\n  margin: 0 auto;\r\n  display: flex;\r\n  background: #f2f2f2;\r\n  align-items: center;\r\n  padding: 0 10px;\r\n  margin-bottom: 25px;\r\n  img {\r\n    background: #f2f2f2;\r\n    width: 50px;\r\n    height: 50px;\r\n  }\r\n  p {\r\n    padding-left: 10px;\r\n  }\r\n}\r\n.code {\r\n  position: absolute;\r\n  right: 0;\r\n  top: 0;\r\n  line-height: 50px;\r\n  width: 80px;\r\n  color: #999;\r\n  &:hover {\r\n    cursor: pointer;\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./callback-bind.vue?vue&type=template&id=052aa9ea&scoped=true\"\nimport script from \"./callback-bind.vue?vue&type=script&lang=js\"\nexport * from \"./callback-bind.vue?vue&type=script&lang=js\"\n\nimport \"./callback-bind.vue?vue&type=style&index=0&id=052aa9ea&scoped=true&lang=less\"\n\nimport exportComponent from \"C:\\\\Users\\\\Administrator\\\\Desktop\\\\eribbit-client-pc\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-052aa9ea\"]])\n\nexport default __exports__","import { render } from \"./callback.vue?vue&type=template&id=51e47612&scoped=true\"\nimport script from \"./callback.vue?vue&type=script&lang=js\"\nexport * from \"./callback.vue?vue&type=script&lang=js\"\n\nimport \"./callback.vue?vue&type=style&index=0&id=51e47612&lang=less&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\Administrator\\\\Desktop\\\\eribbit-client-pc\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-51e47612\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","_hoisted_2","_hoisted_6","_hoisted_7","_hoisted_9","_hoisted_10","_createVNode","_component_LoginHeader","$setup","_createElementBlock","_hoisted_1","_hoisted_4","_hoisted_5","onClick","active","href","_hoisted_12","_component_CallbackBind","unionId","nickname","_ctx","avatar","_hoisted_13","_component_CallbackPatch","_component_LoginFooter","_createBlock","_component_Form","ref","autocomplete","errors","_hoisted_3","_component_Field","err","account","name","type","placeholder","mobile","_hoisted_8","_hoisted_11","code","_hoisted_14","_hoisted_15","password","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","rePassword","_hoisted_20","components","Form","Field","props","String","default","setup","form","reactive","mySchema","schema","formCom","time","pause","resume","useIntervalFn","value","immediate","send","async","valid","userQQPatchCode","Message","text","setFieldError","store","useStore","router","useRouter","submit","validate","userQQPatchLogin","then","data","console","log","id","nickName","token","result","commit","dispatch","push","state","user","redirecturl","catch","e","__exports__","src","alt","QC","success","res","figureurl_1","userQQBindCode","userQQBindLogin","LoginHeader","LoginFooter","CallbackBind","CallbackPatch","hasAccount","isBind","openId","userQQLogin","render"],"sourceRoot":""}